# 组件通信

## 1.父传子

### 1-1. props

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>props传参</div>
    <props-child :count="propsCount" @add-count="addCount" />
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import PropsChild from "./PropsChild.vue";

const propsCount = ref(0);
const addCount = (count: number) => {
  propsCount.value += count;
};
</script>

<!-- 子组件 props-child.vue -->
<template>
  <div>
    <div>子组件--props</div>
    <div>count: {{ count }}</div>
    <el-button @click="emit('add-count', 1)">+1</el-button>
  </div>
</template>

<script setup lang="ts">
// 父传子
const props = defineProps<{
  count: number;
}>();
</script>
```

### 1-2. v-model

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>v-model传参</div>
    <div>vModelCount {{ vModelCount }}</div>
    <v-model-child v-model:count="vModelCount" />
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import VModelChild from "./VModelChild.vue";

const vModelCount = ref(0);
const addCount = (count: number) => {
  propsCount.value += count;
};
</script>

<!-- 子组件 v-model-child.vue -->
<template>
  <div>
    <div>子组件--v-model传参</div>
    <div>v-model参数：{{ count }}</div>
    <el-button @click="() => count--">-1</el-button>
  </div>
</template>

<script setup lang="ts">
const count = defineModel<number>("count", { default: 0 });
</script>
```

### 1-3. $refs

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>$refs传参</div>
    <refs-child ref="refsChildRef" />
    <el-button @click="updateRefsChildCount">更新refsChildCount</el-button>
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import RefsChild from "./RefsChild.vue";
const refsChildRef = ref<InstanceType<typeof RefsChild>>();
const updateRefsChildCount = () => {
  refsChildRef.value!.count += 10;
};
</script>

<!-- 子组件 refs-child.vue -->
<template>
  <div>
    <div>子组件--$refs</div>
    <div>count {{ count }}</div>
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
const count = ref(0);
</script>
```

### 1-4. 默认插槽、具名插槽

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>slot传参</div>
    <slot-child>
      <template #default>
        <div>默认插槽</div>
      </template>
      <template #img>
        <img :src="imgUrl" alt="img" />
      </template>
    </slot-child>
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import SlotChild from "./SlotChild.vue";
const imgUrl = ref("https://vuejs.org/images/logo.png");
</script>

<!-- 子组件 slot-child.vue -->
<template>
  <div class="w-max">
    <div>子组件--slot</div>
    <div class="bg-blue-200 rounded-8 p-16"></div>
      <slot>默认内容</slot>
      <slot name="img" />
    </div>
  </div>
</template>
```

## 2.子传父

### 2.1 props

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>props传参</div>
    <div>{{ propsCount }}</div>
    <props-child :addCount="addCount" />
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import PropsChild from "./PropsChild.vue";

const propsCount = ref(0);
const addCount = (count: number) => {
  propsCount.value += count;
};
</script>

<!-- 子组件 props-child.vue -->
<template>
  <div>
    <div>子组件--props</div>
    <el-button @click="addCount(1)">+1</el-button>
  </div>
</template>

<script setup lang="ts">
// 子传父
const props = defineProps<{
  addCount: (count: number) => void;
}>();
</script>
```

### 2.2 自定义事件

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>props传参</div>
    <div>{{ propsCount }}</div>
    <props-child @add-count="addCount" />
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import PropsChild from "./PropsChild.vue";

const propsCount = ref(0);
const addCount = (count: number) => {
  propsCount.value += count;
};
</script>

<!-- 子组件 props-child.vue -->
<template>
  <div>
    <div>子组件--props</div>
    <el-button @click="emit('add-count', 1)">+1</el-button>
  </div>
</template>

<script setup lang="ts">
// 子传父
const emit = defineEmits<{
  "add-count": [count: number];
}>();
</script>
```

### 2.3 v-model

### 2.4 $parent

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>$parent</div>
    <div>parentCount {{ parentCount }}</div>
    <parent-child />
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import ParentChild from "./ParentChild.vue";
</script>

<!-- 子组件 parent-child.vue -->
<template>
  <div>
    <div>子组件--$parent</div>
    <el-button @click="updateParentCount($parent)">更新parentCount</el-button>
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
const updateParentCount = (parent: any) => {
  parent.parentCount.value += 10;
};
</script>
```

### 2.5 作用域插槽

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>作用域slot传参</div>
    <slot-child>
      <template #default="{list}">
        <ul>
          <li v-for="item in list" :key="item.value">
            {{ item.label }}
          </li>
        </ul>
      </template>
    </slot-child>
  </div>
</template>
<script setup lang="ts">
import { ref } from "vue";
import SlotChild from "./SlotChild.vue";
const imgUrl = ref("https://vuejs.org/images/logo.png");
</script>

<!-- 子组件 slot-child.vue -->
<template>
  <div class="w-max">
    <div>子组件--slot</div>
    <div class="bg-blue-200 rounded-8 p-16"></div>
      <slot :list="list"></slot>
    </div>
  </div>
</template>
<script setup lang="ts">
const list = ref([
  {
    label: 'item1',
    value: 1,
  },
  {
    label: 'item2',
    value: 2,
  },
  {
    label: 'item3',
    value: 3,
  },
])
</script>
```

## 3. 祖传孙、孙传祖

### 3-1. $attrs 子组件未通过 props 接收的属性

```vue
<!-- 祖先组件 -->
<template>
  <div>
    <div>attrs传参</div>
    <attrs-child x="1" y="2" z="3" />
  </div>
</template>

<!-- 子组件 attrs-child.vue -->
<template>
  <div>
    <div>子组件4--attrs</div>
    <div>attrs {{ $attrs }}</div>
    <attrs-grand-child v-bind="$attrs" />
  </div>
</template>

<script setup lang="ts">
import attrsGrandChild from "./attrs-grand-child.vue";

const props = defineProps<{
  x: string;
}>();
</script>

<!-- 孙子组件 attrs-grand-child.vue -->
<template>
  <div>
    <div>attrs孙子组件</div>
    <div>爷爷传的y {{ y }}</div>
    <div>爷爷传的z {{ z }}</div>
  </div>
</template>

<script setup lang="ts">
const props = defineProps(["y", "z"]);
</script>
```

### 3-2. provide/inject

```vue
<!-- 父组件 -->
<template>
  <div>
    <div>provide-inject传参</div>
    <provide-inject-child />
  </div>
</template>
<script setup lang="ts">
import { ref, provide } from "vue";
import ProvideInjectChild from "./provide-inject-child.vue";
const provideCount = ref(0);

const updateProvideCount = (num: number) => {
  provideCount.value += num;
};

provide("provideData", {
  provideCount,
  updateProvideCount,
});
</script>

<!-- 子组件 provide-inject-child.vue -->
<template>
  <div>
    <div>子组件--provide-inject</div>
    <div>count:{{ provideCount }}</div>
    <el-button @click="updateProvideCount(10)">+10</el-button>
  </div>
</template>

<script setup lang="ts">
import { inject } from "vue";

interface ProvideData {
  provideCount: number;
  updateProvideCount: (num: number) => void;
}

const { provideCount, updateProvideCount } = inject<ProvideData>(
  "provideData",
  {
    provideCount: 0,
    updateProvideCount: (num: number) => {},
  }
);
</script>
```

### 4. 兄弟组件、任意组件间通信

### 4-1. mitt

```vue
<!-- 组件1 -->
<template>
  <div>
    <div>mitt传参</div>
    <mitt-child />
    <el-button @click="updateName">修改名字</el-button>
  </div>
</template>
<script setup lang="ts">
import mitt from "mitt";
import MittChild from "./MittChild.vue";
import { ref } from "vue";
const emitter = mitt();

const updateName = () => {
  emitter.emit("update-name", "Lebron James");
};
</script>

<!-- 组件2 mitt-child.vue -->
<template>
  <div>
    <div>子组件2--mitt传参</div>
    <div>Hello, {{ name }}</div>
  </div>
</template>

<script setup lang="ts">
import emitter from "@/utils/emitter";
import { onUnmounted, ref } from "vue";

const name = ref("James");

emitter.on("update-name", e => {
  name.value = <string>e;
});

onUnmounted(() => {
  emitter.off("update-name");
});
</script>
```

### 4-2. pinia
